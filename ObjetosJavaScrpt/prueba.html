<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uso de canvas</title>
    <style>
        /* Estilo general */
        body {
            font-family: Arial, sans-serif;
            background-color: #f2f2f2;
            margin: 0;
            padding: 20px;
        }

        .contenedor {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 5px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
        }

        /* Controles en dos columnas */
        .controles {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
        }

        .columna-izq,
        .columna-der {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .fila-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .fila-control label {
            width: 120px;
            font-size: 0.9rem;
        }

        .fila-control input[type="range"] {
            flex: 1;
        }

        .valor {
            width: 40px;
            text-align: right;
            font-size: 0.8rem;
        }

        .columna-der h4 {
            margin: 0 0 5px 0;
        }

        #grafico {
            text-align: center;
            padding: 10px;
            border: 1px solid #ddd;
            min-height: 200px;
            background-color: #fafafa;
        }

        #btn-reset {
            margin-top: 10px;
            padding: 5px 10px;
            font-size: 0.9rem;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div class="contenedor">
        <h1>Manipulando Imágenes con <em>Canvas</em></h1>

        <section class="controles">
            <!-- Columna izquierda: dimensiones y perspectiva -->
            <div class="columna-izq">
                <div class="fila-control">
                    <label for="in-largo">Largo</label>
                    <input type="range" id="in-largo" min="50" max="1500" step="10">
                    <span class="valor" id="val-largo"></span>
                </div>

                <div class="fila-control">
                    <label for="in-alto">Alto</label>
                    <input type="range" id="in-alto" min="50" max="1500" step="10">
                    <span class="valor" id="val-alto"></span>
                </div>

                <div class="fila-control">
                    <label for="in-ancho">Ancho</label>
                    <input type="range" id="in-ancho" min="50" max="1500" step="10">
                    <span class="valor" id="val-ancho"></span>
                </div>

                <div class="fila-control">
                    <label for="in-size">Tamaño lienzo</label>
                    <input type="range" id="in-size" min="200" max="1000" step="50">
                    <span class="valor" id="val-size"></span>
                </div>

                <div class="fila-control">
                    <label for="in-perspectiva">Perspectiva</label>
                    <input type="range" id="in-perspectiva" min="2" max="20" step="1">
                    <span class="valor" id="val-perspectiva"></span>
                </div>

                <button id="btn-reset">Restablecer</button>
            </div>

            <!-- Columna derecha: color -->
            <div class="columna-der">
                <h4>Color</h4>

                <div class="fila-control">
                    <label for="in-rojo">Rojo</label>
                    <input type="range" id="in-rojo" min="0" max="255" step="1">
                    <span class="valor" id="val-rojo"></span>
                </div>

                <div class="fila-control">
                    <label for="in-verde">Verde</label>
                    <input type="range" id="in-verde" min="0" max="255" step="1">
                    <span class="valor" id="val-verde"></span>
                </div>

                <div class="fila-control">
                    <label for="in-azul">Azul</label>
                    <input type="range" id="in-azul" min="0" max="255" step="1">
                    <span class="valor" id="val-azul"></span>
                </div>
            </div>
        </section>

        <section id="grafico"></section>
    </div>

    <script>
        // Configuración centralizada (adiós números mágicos sueltos)
        const CONFIG = {
            grosorLinea: 2,
            alphaCaraPrincipal: 0.6,
            alphaCaraSecundaria: 0.4,
            colorFondoCanvas: "#ffffff"
        };

        // Referencias a los inputs
        const SIZE         = document.querySelector('#in-size');
        const PERSPECTIVA  = document.querySelector('#in-perspectiva');
        const LARGO        = document.querySelector('#in-largo');
        const ANCHO        = document.querySelector('#in-ancho');
        const ALTO         = document.querySelector('#in-alto');
        const ROJO         = document.querySelector('#in-rojo');
        const VERDE        = document.querySelector('#in-verde');
        const AZUL         = document.querySelector('#in-azul');
        const BTN_RESET    = document.querySelector('#btn-reset');

        // Referencias a los <span> que muestran los valores
        const VAL_LARGO        = document.querySelector('#val-largo');
        const VAL_ANCHO        = document.querySelector('#val-ancho');
        const VAL_ALTO         = document.querySelector('#val-alto');
        const VAL_SIZE         = document.querySelector('#val-size');
        const VAL_PERSPECTIVA  = document.querySelector('#val-perspectiva');
        const VAL_ROJO         = document.querySelector('#val-rojo');
        const VAL_VERDE        = document.querySelector('#val-verde');
        const VAL_AZUL         = document.querySelector('#val-azul');

        // Dibuja un cubo con perspectiva sobre un canvas y devuelve el canvas
        function dibujaCubo(largo, ancho, alto, color, dimensiones, profundidad) {
            const lienzo = dimensiones;
            const perspectiva = profundidad;
            const canvas = document.createElement("canvas");
            const ctx = canvas.getContext("2d");

            canvas.width = lienzo;
            canvas.height = lienzo;

            // Fondo del canvas
            ctx.fillStyle = CONFIG.colorFondoCanvas;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const limite = lienzo - (lienzo / perspectiva);
            const mayor = Math.max(largo, ancho, alto);

            let largoEsc = largo;
            let anchoEsc = ancho;
            let altoEsc  = alto;
            let grosor   = CONFIG.grosorLinea;

            // Escalado si el cubo es más grande que el lienzo disponible
            if (mayor > limite) {
                const coef = limite / mayor;
                largoEsc *= coef;
                anchoEsc *= coef;
                altoEsc  *= coef;
                grosor   *= coef;
            }

            const largoPersp = largoEsc / perspectiva;
            const x = (lienzo - (anchoEsc + largoPersp)) / 2;
            const y = (lienzo - (altoEsc + largoPersp)) / 2;

            ctx.save(); // guardamos el estado inicial del contexto
            ctx.translate(x, y);

            // Configuración de líneas
            ctx.lineWidth = grosor;
            ctx.strokeStyle = color;

            // ==== Caras del cubo ====

            // Cara frontal
            ctx.fillStyle = color;
            ctx.globalAlpha = CONFIG.alphaCaraPrincipal;
            ctx.fillRect(0, 0, anchoEsc, altoEsc);

            // Cara superior (paralelogramo)
            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.lineTo(largoPersp, largoPersp);
            ctx.lineTo(anchoEsc + largoPersp, largoPersp);
            ctx.lineTo(anchoEsc, 0);
            ctx.closePath();
            ctx.stroke();
            ctx.fill();

            // Cara lateral
            ctx.globalAlpha = CONFIG.alphaCaraSecundaria;
            ctx.beginPath();
            ctx.moveTo(anchoEsc, 0);
            ctx.lineTo(anchoEsc + largoPersp, largoPersp);
            ctx.lineTo(anchoEsc + largoPersp, largoPersp + altoEsc);
            ctx.lineTo(anchoEsc, altoEsc);
            ctx.closePath();
            ctx.stroke();
            ctx.fill();

            ctx.restore(); // volvemos al estado original del contexto

            return canvas;
        }

        // Actualiza los numeritos al lado de cada slider
        function actualizaValores() {
            VAL_LARGO.textContent       = LARGO.value;
            VAL_ANCHO.textContent       = ANCHO.value;
            VAL_ALTO.textContent        = ALTO.value;
            VAL_SIZE.textContent        = SIZE.value;
            VAL_PERSPECTIVA.textContent = PERSPECTIVA.value;
            VAL_ROJO.textContent        = ROJO.value;
            VAL_VERDE.textContent       = VERDE.value;
            VAL_AZUL.textContent        = AZUL.value;
        }

        // Inserta el cubo en el <section id="grafico">
        function insertaCubo() {
            actualizaValores();

            const size        = Number(SIZE.value);
            const perspectiva = Number(PERSPECTIVA.value);
            const largo       = Number(LARGO.value);
            const ancho       = Number(ANCHO.value);
            const alto        = Number(ALTO.value);

            const r = Number(ROJO.value);
            const g = Number(VERDE.value);
            const b = Number(AZUL.value);
            const color = `rgb(${r},${g},${b})`;

            const grafico = document.getElementById("grafico");
            grafico.innerHTML = "";

            const canvas = dibujaCubo(largo, ancho, alto, color, size, perspectiva);
            grafico.appendChild(canvas);
        }

        // Valores iniciales "razonables"
        function resetControles() {
            LARGO.value       = 500;
            ANCHO.value       = 500;
            ALTO.value        = 500;
            SIZE.value        = 600;
            PERSPECTIVA.value = 8;
            ROJO.value        = 0;
            VERDE.value       = 0;
            AZUL.value        = 255;
            insertaCubo();
        }

        // Eventos: todos los sliders redibujan al cambiar
        [
            SIZE, PERSPECTIVA, LARGO, ANCHO, ALTO,
            ROJO, VERDE, AZUL
        ].forEach(input => {
            input.addEventListener('input', insertaCubo);
        });

        BTN_RESET.addEventListener('click', resetControles);

        // Primera carga
        resetControles();
    </script>
</body>
</html>
