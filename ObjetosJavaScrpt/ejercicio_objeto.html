<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor de Paquetería</title>
</head>

<body>
    <h1>Gestor de Paquetería</h1>
    <p>Aplicación que gestiona repartidores y paquetes usando objetos.</p>

    <ul>
        <li>Objeto <strong>Repartidor</strong></li>
        <li>Objeto <strong>Paquete</strong></li>
        <li>Interfaz para crear repartidores</li>
        <li>Los repartidores se almacenan en un <code>Array</code></li>
        <li>Interfaz para crear paquetes</li>
        <li>El repartidor de cada paquete se selecciona desde un <code>&lt;select&gt;</code></li>
        <li>Cada objeto <code>Paquete</code> se guarda en un objeto principal <code>Reparto</code></li>
        <li>Representación visual de cada paquete con su información</li>
    </ul>

    <!-- FORMULARIO REPARTIDOR -->
    <form id="formRepartidor">
        <h2>Crear Repartidor</h2>

        <label for="nombreRepartidor">Nombre:</label>
        <input type="text" id="nombreRepartidor" required>

        <label for="vehiculoRepartidor">Vehículo (matrícula):</label>
        <input type="text" id="vehiculoRepartidor" required>

        <label for="experienciaRepartidor">Experiencia (años):</label>
        <input type="number" id="experienciaRepartidor" min="0" value="0" required>

        <button type="submit">Crear Repartidor</button>
    </form>

    <!-- FORMULARIO PAQUETE -->
    <form id="formPaquete">
        <h2>Crear Paquete</h2>

        <label for="descripcionPaquete">Descripción:</label>
        <input type="text" id="descripcionPaquete" required>

        <label for="pesoPaquete">Peso (kg):</label>
        <input type="number" id="pesoPaquete" min="0.1" step="0.1" required>

        <label for="largoPaquete">Largo (cm):</label>
        <input type="number" id="largoPaquete" min="1" required>

        <label for="anchoPaquete">Ancho (cm):</label>
        <input type="number" id="anchoPaquete" min="1" required>

        <label for="destinoPaquete">Destino:</label>
        <input type="text" id="destinoPaquete" required>

        <label for="colorPaquete">Color:</label>
        <input type="text" id="colorPaquete" required>

        <label for="repartidorPaquete">Repartidor:</label>
        <select id="repartidorPaquete" required>
            <option value="" disabled selected>Seleccione un repartidor</option>
        </select>

        <button type="submit">Crear Paquete</button>
    </form>

    <h2>Paquetes creados</h2>
    <div id="listadoPaquetes"></div>

    <script>
        /********* CONSTRUCTORES (MISMA LÓGICA QUE TU CÓDIGO) *********/

        function Repartidor(nombre, vehiculo, experiencia) {
            this.nombre = nombre;
            this.vehiculo = vehiculo;
            this.experiencia = experiencia; // en años
        }

        function Paquete(id, descripcion, peso, largo, ancho, destino, color, repartidor) {
            this.id = id;
            this.descripcion = descripcion;
            this.peso = peso;
            this.largo = largo;
            this.ancho = ancho;
            this.destino = destino;
            this.color = color;
            this.repartidor = repartidor;
            this.superficie = function () {
                return this.ancho * this.largo;
            };
            this.volumen = function (alto) {
                return this.superficie() * alto;
            };
        }

        /********* OBJETO PRINCIPAL REPARTO *********/

        let Reparto = {
            paquetes: [],
            agregarPaquete: function (paquete) {
                this.paquetes.push(paquete);
            }
        };

        /********* ESTRUCTURAS DE DATOS *********/

        let listaRepartidores = []; // Array de repartidores

        /********* REFERENCIAS AL DOM *********/

        const formRepartidor = document.getElementById('formRepartidor');
        const formPaquete = document.getElementById('formPaquete');
        const selectRepartidor = document.getElementById('repartidorPaquete');
        const listadoPaquetes = document.getElementById('listadoPaquetes');

        /********* FUNCIONES AUXILIARES *********/

        function actualizarSelectRepartidores() {
            selectRepartidor.innerHTML = '';

            const opcionInicial = document.createElement('option');
            opcionInicial.value = '';
            opcionInicial.disabled = true;
            opcionInicial.selected = true;
            opcionInicial.textContent = 'Seleccione un repartidor';
            selectRepartidor.append(opcionInicial);

            listaRepartidores.forEach(function (rep, index) {
                const opt = document.createElement('option');
                opt.value = index; // índice en el array
                opt.textContent = rep.nombre + ' (' + rep.vehiculo + ')';
                selectRepartidor.append(opt);
            });
        }

        function pintarPaquetes() {
            listadoPaquetes.innerHTML = '';

            if (Reparto.paquetes.length === 0) {
                listadoPaquetes.innerHTML = '<p>No hay paquetes creados.</p>';
                return;
            }

            Reparto.paquetes.forEach(function (paquete) {
                const card = document.createElement('div');
                card.style.border = '1px solid #ccc';
                card.style.margin = '10px 0';
                card.style.padding = '10px';

                // Recorremos las propiedades del paquete con for...in
                for (const key in paquete) {
                    if (!Object.hasOwn(paquete, key)) continue;
                    const valor = paquete[key];
                    if (typeof valor === 'function') continue; // saltamos métodos

                    const p = document.createElement('p');

                    // Caso especial: repartidor es un objeto, mostramos nombre y vehículo
                    if (key === 'repartidor') {
                        p.innerHTML = '<strong>' + key +
                            '</strong> ' + valor.nombre + ' (' + valor.vehiculo + ')';
                    } else {
                        p.innerHTML = ' <strong>' + key +
                            '</strong> ' + valor;
                    }

                    card.appendChild(p);
                }

                // Línea extra con superficie y volumen (usa los métodos del objeto)
                const extra = document.createElement('p');
                extra.innerHTML =
                    'Superficie: <strong>' + paquete.superficie() +
                    ' cm²</strong> — Volumen (alto = 30): <strong>' +
                    paquete.volumen(30) + ' cm³</strong>';
                card.appendChild(extra);

                listadoPaquetes.appendChild(card);
            });
        }

        /********* EVENTO: CREAR REPARTIDOR *********/

        formRepartidor.addEventListener('submit', function (event) {
            event.preventDefault();

            const nombre = document.getElementById('nombreRepartidor').value.trim();
            const vehiculo = document.getElementById('vehiculoRepartidor').value.trim();
            const experiencia = parseInt(document.getElementById('experienciaRepartidor').value);

            if (!nombre || !vehiculo || isNaN(experiencia)) {
                alert('Por favor, complete todos los campos del repartidor.');
                return;
            }

            const nuevoRepartidor = new Repartidor(nombre, vehiculo, experiencia);
            listaRepartidores.push(nuevoRepartidor);

            actualizarSelectRepartidores();
            formRepartidor.reset();
        });

        /********* EVENTO: CREAR PAQUETE *********/

        formPaquete.addEventListener('submit', function (event) {
            event.preventDefault();

            const descripcion = document.getElementById('descripcionPaquete').value.trim();
            const peso = parseFloat(document.getElementById('pesoPaquete').value);
            const largo = parseFloat(document.getElementById('largoPaquete').value);
            const ancho = parseFloat(document.getElementById('anchoPaquete').value);
            const destino = document.getElementById('destinoPaquete').value.trim();
            const color = document.getElementById('colorPaquete').value.trim();
            const indiceRepartidor = selectRepartidor.value;

            if (!descripcion || !peso || !largo || !ancho || !destino || !color || indiceRepartidor === '') {
                alert('Por favor, complete todos los campos del paquete y seleccione un repartidor.');
                return;
            }

            const repartidorAsignado = listaRepartidores[indiceRepartidor];
            const nuevoId = Reparto.paquetes.length + 1;

            const nuevoPaquete = new Paquete(
                nuevoId,
                descripcion,
                peso,
                largo,
                ancho,
                destino,
                color,
                repartidorAsignado
            );

            Reparto.agregarPaquete(nuevoPaquete);
            pintarPaquetes();
            formPaquete.reset();
        });

        // Estado inicial
        actualizarSelectRepartidores();
        pintarPaquetes();
    </script>
</body>

</html>
